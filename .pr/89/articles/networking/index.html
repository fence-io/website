<!doctype html><html lang=en-us dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color><link rel="shortcut icon" href=/website/.pr/89/favicon.ico><title>Setting up Load Balancer Service with Cilium in KinD Cluster | Fence</title>
<meta name=image property="og:image" content="/website/.pr/89/articles/networking/networking.png"><style>body{font-family:roboto}</style><link rel=stylesheet href=/website/.pr/89/css/main.min.6bc6ab3ae6e56364c43d88aa832bf6f51ce47036a8fade1a4e51d757a720a778.css integrity="sha256-a8arOublY2TEPYiqgyv29RzkcDao+t4aTlHXV6cgp3g=" crossorigin=anonymous><link rel=stylesheet href=/website/.pr/89/css/schemes/slate.min.49077614e43328c746e214d8c7c3c820cdeadaf2eccb92e06d0aba4e2e102d4d.css integrity="sha256-SQd2FOQzKMdG4hTYx8PIIM3q2vLsy5LgbQq6Ti4QLU0=" crossorigin=anonymous><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel=stylesheet><script src=/website/.pr/89/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js integrity="sha256-I80MfYNyY7nq65buLZzPopadqj+gD6HB/ocBqbhyUaE=" crossorigin=anonymous></script><script type=text/javascript src=/website/.pr/89/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script src=/website/.pr/89/lib/jquery/jquery.slim.min.js integrity></script></head><body id=top class="relative flex flex-col bg-neutral text-neutral-900 dark:bg-neutral-900 dark:text-neutral"><div class="fixed top-0 bottom-0 left-0 right-0 animate-[fadeIn_1s_ease-in-out]" style=z-index:-1><img src=/website/.pr/89/img/background.svg class="w-full h-full object-cover"></div><div class="sticky top-0 bg-neutral/70 text-neutral-900 dark:bg-neutral-900/70 dark:text-neutral" style=z-index:100><div class=mx-6><div class="main-menu flex items-center justify-between"><a href=/website/.pr/89/ class="flex w-8 h-8 my-3 drop-shadow-[0_0_0.75rem_crimson]"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentcolor" d="M12 3.75A6.715 6.715.0 008.278 4.868.75.75.0 117.45 3.618a8.25 8.25.0 0112.8 6.883c0 3.014-.574 5.897-1.62 8.543a.75.75.0 01-1.395-.551A21.69 21.69.0 0018.75 10.5 6.75 6.75.0 0012 3.75zM6.157 5.739a.75.75.0 01.21 1.04A6.715 6.715.0 005.25 10.5c0 1.613-.463 3.12-1.265 4.393a.75.75.0 01-1.27-.8A6.715 6.715.0 003.75 10.5c0-1.68.503-3.246 1.367-4.55a.75.75.0 011.04-.211zM12 7.5a3 3 0 00-3 3c0 3.1-1.176 5.927-3.105 8.056a.75.75.0 11-1.112-1.008A10.459 10.459.0 007.5 10.5a4.5 4.5.0 119 0c0 .547-.022 1.09-.067 1.626a.75.75.0 01-1.495-.123c.041-.495.062-.996.062-1.503a3 3 0 00-3-3zm0 2.25a.75.75.0 01.75.75c0 3.908-1.424 7.485-3.781 10.238a.75.75.0 01-1.14-.975A14.19 14.19.0 0011.25 10.5.75.75.0 0112 9.75zm3.239 5.183a.75.75.0 01.515.927 19.417 19.417.0 01-2.585 5.544.75.75.0 01-1.243-.84 17.915 17.915.0 002.386-5.116.75.75.0 01.927-.515z" clip-rule="evenodd"/></svg></a><nav class=flex-1><a href=/website/.pr/89/ class="text-xl font-bold pl-6">Fence</a></nav><nav class="hidden md:flex items-center space-x-5"><a href=/website/.pr/89/articles/ class="flex items-center"><p class="text-base font-medium" title>Articles</p></a><a href=/website/.pr/89/podcasts/ class="flex items-center"><p class="text-base font-medium" title>Podcasts</p></a><a href=/website/.pr/89/videos/ class="flex items-center"><p class="text-base font-medium" title>Videos</p></a><a href=/website/.pr/89/blog/ class="flex items-center"><p class="text-base font-medium" title>Blog</p></a><a href=/website/.pr/89/ class="flex items-center"><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path d="M11.47 3.841a.75.75.0 011.06.0l8.69 8.69a.75.75.0 101.06-1.061l-8.689-8.69a2.25 2.25.0 00-3.182.0l-8.69 8.69a.75.75.0 101.061 1.06l8.69-8.689z"/><path d="m12 5.432 8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75.0 01-.75-.75v-4.5a.75.75.0 00-.75-.75h-3a.75.75.0 00-.75.75V21a.75.75.0 01-.75.75H5.625A1.875 1.875.0 013.75 19.875v-6.198a2.29 2.29.0 00.091-.086L12 5.432z"/></svg></span></span><p class="text-base font-medium" title></p></a><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M10.5 6a1.5 1.5.0 113 0 1.5 1.5.0 01-3 0zm0 6a1.5 1.5.0 113 0 1.5 1.5.0 01-3 0zm0 6a1.5 1.5.0 113 0 1.5 1.5.0 01-3 0z" clip-rule="evenodd"/></svg>
</span><a href=https://github.com/fence-io/website class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://todo class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://todo class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1s21.16-47.06 47.06-47.06h47.06v47.06zm23.72.0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9.0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9.0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96.0 222.8.0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06S448 171 448 196.9s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72.0c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9.0 47.06 21.16 47.06 47.06S309 480 283.1 480s-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9.0-47.06-21.16-47.06-47.06s21.16-47.06 47.06-47.06h117.84c25.9.0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H283.1z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://www.linkedin.com/groups/13033088/ class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://todo class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78.0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://groups.google.com/g/fence-community class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 488 512"><path fill="currentcolor" d="M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2.0 256S110.8 8 248 8c66.8.0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2.0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"/></svg></span></span><p class="text-base font-medium" title></p></a><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M10.5 6a1.5 1.5.0 113 0 1.5 1.5.0 01-3 0zm0 6a1.5 1.5.0 113 0 1.5 1.5.0 01-3 0zm0 6a1.5 1.5.0 113 0 1.5 1.5.0 01-3 0z" clip-rule="evenodd"/></svg>
</span><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M9.528 1.718a.75.75.0 01.162.819A8.97 8.97.0 009 6a9 9 0 009 9 8.97 8.97.0 003.463-.69.75.75.0 01.981.98 10.503 10.503.0 01-9.694 6.46c-5.799.0-10.5-4.7-10.5-10.5.0-4.368 2.667-8.112 6.46-9.694a.75.75.0 01.818.162z" clip-rule="evenodd"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path d="M12 2.25a.75.75.0 01.75.75v2.25a.75.75.0 01-1.5.0V3a.75.75.0 01.75-.75zM7.5 12a4.5 4.5.0 119 0 4.5 4.5.0 01-9 0zM18.894 6.166a.75.75.0 00-1.06-1.06l-1.591 1.59a.75.75.0 101.06 1.061l1.591-1.59zM21.75 12a.75.75.0 01-.75.75h-2.25a.75.75.0 010-1.5H21a.75.75.0 01.75.75zm-3.916 6.894a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 10-1.061 1.06l1.59 1.591zM12 18a.75.75.0 01.75.75V21a.75.75.0 01-1.5.0v-2.25A.75.75.0 0112 18zM7.758 17.303a.75.75.0 00-1.061-1.06l-1.591 1.59a.75.75.0 001.06 1.061l1.591-1.59zM6 12a.75.75.0 01-.75.75H3a.75.75.0 010-1.5h2.25A.75.75.0 016 12zm.697-4.243a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 00-1.061 1.06l1.59 1.591z"/></svg></span></div></button></div></nav></div><nav class="main-menu flex md:hidden items-center justify-between space-x-2"><a href=/website/.pr/89/articles/ class="flex items-center"><p class="text-base font-medium" title>Articles</p></a><a href=/website/.pr/89/podcasts/ class="flex items-center"><p class="text-base font-medium" title>Podcasts</p></a><a href=/website/.pr/89/videos/ class="flex items-center"><p class="text-base font-medium" title>Videos</p></a><a href=/website/.pr/89/blog/ class="flex items-center"><p class="text-base font-medium" title>Blog</p></a><a href=/website/.pr/89/ class="flex items-center"><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path d="M11.47 3.841a.75.75.0 011.06.0l8.69 8.69a.75.75.0 101.06-1.061l-8.689-8.69a2.25 2.25.0 00-3.182.0l-8.69 8.69a.75.75.0 101.061 1.06l8.69-8.689z"/><path d="m12 5.432 8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75.0 01-.75-.75v-4.5a.75.75.0 00-.75-.75h-3a.75.75.0 00-.75.75V21a.75.75.0 01-.75.75H5.625A1.875 1.875.0 013.75 19.875v-6.198a2.29 2.29.0 00.091-.086L12 5.432z"/></svg></span></span><p class="text-base font-medium" title></p></a><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M10.5 6a1.5 1.5.0 113 0 1.5 1.5.0 01-3 0zm0 6a1.5 1.5.0 113 0 1.5 1.5.0 01-3 0zm0 6a1.5 1.5.0 113 0 1.5 1.5.0 01-3 0z" clip-rule="evenodd"/></svg>
</span><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M9.528 1.718a.75.75.0 01.162.819A8.97 8.97.0 009 6a9 9 0 009 9 8.97 8.97.0 003.463-.69.75.75.0 01.981.98 10.503 10.503.0 01-9.694 6.46c-5.799.0-10.5-4.7-10.5-10.5.0-4.368 2.667-8.112 6.46-9.694a.75.75.0 01.818.162z" clip-rule="evenodd"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path d="M12 2.25a.75.75.0 01.75.75v2.25a.75.75.0 01-1.5.0V3a.75.75.0 01.75-.75zM7.5 12a4.5 4.5.0 119 0 4.5 4.5.0 01-9 0zM18.894 6.166a.75.75.0 00-1.06-1.06l-1.591 1.59a.75.75.0 101.06 1.061l1.591-1.59zM21.75 12a.75.75.0 01-.75.75h-2.25a.75.75.0 010-1.5H21a.75.75.0 01.75.75zm-3.916 6.894a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 10-1.061 1.06l1.59 1.591zM12 18a.75.75.0 01.75.75V21a.75.75.0 01-1.5.0v-2.25A.75.75.0 0112 18zM7.758 17.303a.75.75.0 00-1.061-1.06l-1.591 1.59a.75.75.0 001.06 1.061l1.591-1.59zM6 12a.75.75.0 01-.75.75H3a.75.75.0 010-1.5h2.25A.75.75.0 016 12zm.697-4.243a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 00-1.061 1.06l1.59 1.591z"/></svg></span></div></button></div></nav><script>(function(){var e=$(".main-menu");e.find(`a[href="${window.location.pathname}"]`).each(function(e,t){$(t).children("p").addClass("active")})})()</script></div></div><main id=main-content class=min-h-[calc(100vh-7rem)]><div class="bg-neutral-900 text-neutral-200 min-h-[inherit]"><div class="grid grid-cols-2 md:grid-cols-4"><div class="hidden md:block mx-8"><div class="flex flex-col sticky top-[8.4rem]"><div class="toc print:hidden"></div></div></div><div class="col-span-2 prose prose-invert py-20 max-w-fit"><h1 class=font-normal>Setting up Load Balancer Service with Cilium in KinD Cluster</h1><div class="text-sm mb-6"><div class="flex flex-row flex-wrap items-center"></div><div class="flex flex-row flex-wrap items-center"><time datetime="2024-05-02 00:00:00 +0000 UTC">May 2, 2024</time><span class="px-2 text-primary-500">&#183;</span><span>3261 words</span><span class="px-2 text-primary-500">&#183;</span><span title>16 mins</span><span class="px-2 text-primary-500">&#183;</span>
<span style=cursor:pointer>By &nbsp;
<span style=margin-top:.5rem class="mr-2 border-cyan-300" onclick='window.open("/website/.pr/89/authors/sara/","_self")'>Sara Qasmi</span></span></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/website/.pr/89/tags/networking/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border px-1 py-[1px] text-xs font-normal">Networking
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/website/.pr/89/tags/kind/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border px-1 py-[1px] text-xs font-normal">KinD
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/website/.pr/89/tags/cilium/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border px-1 py-[1px] text-xs font-normal">Cilium
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/website/.pr/89/tags/load-balancer/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border px-1 py-[1px] text-xs font-normal">Load Balancer
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/website/.pr/89/tags/macos/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border px-1 py-[1px] text-xs font-normal">MacOS</span></span></span></div></div><p>Kubernetes in Docker (KinD) offers a lightweight and efficient way to run Kubernetes clusters for development and testing purposes. However, setting up KinD with load balancing option requires specific networking configurations. In this article, we&rsquo;ll explore the networking configuration of KinD on both Linux and MacOS, deep dive into load balancing options and discuss troubleshooting tactics.</p><h1 class="relative group font-normal">Requirements<div id=requirements class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#requirements aria-label=Anchor>#</a></span></h1><ul><li><a href=https://docs.docker.com/engine/install/>Docker</a></li><li><a href=https://kind.sigs.k8s.io/docs/user/quick-start/#installation>KinD</a></li><li><a href=https://kubernetes.io/docs/tasks/tools/>Kubectl</a></li><li><a href=https://docs.cilium.io/en/stable/gettingstarted/k8s-install-default/>Ciliumctl</a></li></ul><h1 class="relative group font-normal">Setting Up Kubernetes in Docker<div id=setting-up-kubernetes-in-docker class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#setting-up-kubernetes-in-docker aria-label=Anchor>#</a></span></h1><p>To create a KinD cluster with two nodes, you can use the following configuration:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>kind</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Cluster</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>apiVersion</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>kind.x-k8s.io/v1alpha4</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>networking</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681> </span><span style=color:#7ee787>disableDefaultCNI</span>:<span style=color:#6e7681> </span><span style=color:#79c0ff>true</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681> </span><span style=color:#7ee787>kubeProxyMode</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>none</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>nodes</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681> </span>- <span style=color:#7ee787>role</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>control-plane</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681> </span>- <span style=color:#7ee787>role</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>worker</span><span style=color:#6e7681>
</span></span></span></code></pre></div><p>Verify the node status</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>kubectl get nodes
</span></span><span style=display:flex><span>NAME                 STATUS     ROLES           AGE   VERSION
</span></span><span style=display:flex><span>kind-control-plane   NotReady   control-plane   31s   v1.29.2
</span></span><span style=display:flex><span>kind-worker          NotReady   &lt;none&gt;          10s   v1.29.2
</span></span></code></pre></div><p>The nodes are in a &lsquo;NotReady&rsquo; state because the CNI installation is disabled in the KinD config file, where &lsquo;disableDefaultCNI&rsquo; is set to true. This means that the essential networking layer required for pod communication and cluster operation is not configured. Consequently, the kubelet reports a &ldquo;NotReady&rdquo; state as it cannot establish network connectivity. Without CNI, pods cannot be assigned IP addresses.</p><p>In this article, we are going to use Cilium CNI. Cilium offers advanced networking features, enhanced security, service mesh integration, scalability, and comprehensive observability features. In this article, we’re going to explore some of Cilium advanced networking capabilities.</p><p>Deploying Cilium is straightforward, let&rsquo;s simplify things by applying the following configuration:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>cilium install \
</span></span><span style=display:flex><span>  --set kubeProxyReplacement=&#34;strict&#34; \
</span></span><span style=display:flex><span>  --set routingMode=&#34;native&#34; \
</span></span><span style=display:flex><span>  --set ipv4NativeRoutingCIDR=&#34;10.244.0.0/16&#34; \
</span></span><span style=display:flex><span>  --set k8sServiceHost=&#34;kind-control-plane&#34; \
</span></span><span style=display:flex><span>  --set k8sServicePort=6443 \
</span></span><span style=display:flex><span>  --set l2announcements.enabled=true \
</span></span><span style=display:flex><span>  --set l2announcements.leaseDuration=&#34;3s&#34; \
</span></span><span style=display:flex><span>  --set l2announcements.leaseRenewDeadline=&#34;1s&#34; \
</span></span><span style=display:flex><span>  --set l2announcements.leaseRetryPeriod=&#34;500ms&#34; \
</span></span><span style=display:flex><span>  --set devices=&#34;{eth0,net0}&#34; \
</span></span><span style=display:flex><span>  --set externalIPs.enabled=true \
</span></span><span style=display:flex><span>  --set autoDirectNodeRoutes=true \
</span></span><span style=display:flex><span>  --set operator.replicas=2
</span></span></code></pre></div><p>Once the configuration is applied, you can verify the status of the Cilium deployment by executing the command <code>cilium status --wait</code>. This command will display the live deployment status of various Cilium components. Afterwards, running <code>kubectl get nodes</code> will display the nodes in a ready state, confirming the successful setup of networking with Cilium.</p><p>Now let&rsquo;s explore network configuration inside the kubernetes cluster:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>kubectl cluster-info dump | grep -m 1 cluster-cidr
</span></span><span style=display:flex><span>  &#34;--cluster-cidr=10.244.0.0/16&#34;,
</span></span></code></pre></div><p>As you can see, the Kubernetes cluster is configured with a cluster CIDR range of 10.244.0.0/16. This CIDR range is used by cilium CNI for assigning IP addresses to pods within the cluster.</p><p>The subnets assigned to each node are:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>kubectl get nodes -o jsonpath=&#39;{range .items[*]}{.metadata.name}{&#34;\t&#34;}{.spec.podCIDR}{&#34;\n&#34;}&#39;
</span></span><span style=display:flex><span>kind-control-plane	10.244.0.0/24
</span></span><span style=display:flex><span>kind-worker	        10.244.1.0/24
</span></span></code></pre></div><p>Every node is informed about the IP addresses of all pods on every other node, and corresponding routes are added to the Linux kernel routing table of each node. This config is clearly visible when accessing a node within the cluster. You can do this by running <code>docker exec -it kind-worker bash</code> then display the routing table of the node.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>root@kind-worker:/# ip route
</span></span><span style=display:flex><span>default via 172.18.0.1 dev eth0
</span></span><span style=display:flex><span>10.244.0.0/24 via 172.18.0.3 dev eth0 proto kernel
</span></span><span style=display:flex><span>10.244.1.0/24 via 10.244.1.228 dev cilium_host proto kernel src 10.244.1.228
</span></span><span style=display:flex><span>10.244.1.228 dev cilium_host proto kernel scope link
</span></span><span style=display:flex><span>172.18.0.0/16 dev eth0 proto kernel scope link src 172.18.0.2
</span></span></code></pre></div><ol><li><p><code>default via 172.18.0.1 dev eth0</code>: Any traffic that doesn&rsquo;t match a more specific route in the table will be sent through the gateway with the IP address 172.18.0.1 and the outgoing interface eth0.</p></li><li><p><code>10.244.0.0/24 via 172.18.0.3 dev eth0 proto kernel</code>: Route for the subnet 10.244.0.0/24 (kind-control-plan) should be routed via the gateway with the IP address 172.18.0.3 and the outgoing interface eth0.</p></li><li><p><code>10.244.1.0/24 via 10.244.1.228 dev cilium_host proto kernel src 10.244.1.228</code>: Route for the subnet 10.244.1.0/24 (kind-worker) should be sent via the gateway with the IP address 10.244.1.228 via the interface cilium_host. Additionally, it specifies that the source IP address for this traffic should be 10.244.1.228.</p></li><li><p><code>10.244.1.228 dev cilium_host proto kernel scope link</code>: Network device <code>cilium_host</code> with the IP address 10.244.1.228 is directly connected the local network in the container.</p></li></ol><h1 class="relative group font-normal">Cilium&rsquo;s Networking options<div id=ciliums-networking-options class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ciliums-networking-options aria-label=Anchor>#</a></span></h1><p>Cilium represents a modern solution for networking and security in Kubernetes, surpassing the capabilities of traditional components like kube-proxy (disabled in cilium installation <code>kubeProxyReplacement="strict"</code>). While kube-proxy focuses on basic networking tasks such as service discovery and load balancing, Cilium extends its functionality with advanced networking, security, and observability features.</p><p>In terms of load balancing, kube-proxy operates at the network layer (L3/L4) and provides basic load balancing using iptables or IPVS. In contrast, Cilium can handle L3/L4 load balancing and offers more sophisticated techniques. We&rsquo;ll delve into these techniques later in this article.</p><p>Cilium offers two network configurations: encapsulation and direct routing (native <code>routingMode="native"</code>), each suited to different environments and requirements. Encapsulation works well in cloud environments or situations with overlapping networks while native routing is the best option in on-premises setups or dedicated cloud environments where performance optimization is crucial.</p><p>For further details on this topic, refer to the Cilium documentation: <a href=https://docs.cilium.io/en/stable/network/concepts/routing>Cilium Routing Concepts</a>.</p><h1 class="relative group font-normal">Network Configuration of KinD Cluster<div id=network-configuration-of-kind-cluster class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#network-configuration-of-kind-cluster aria-label=Anchor>#</a></span></h1><p>The architecture of the KinD cluster leverages Docker&rsquo;s networking features alongside standard Kubernetes components. Within a Kind cluster, every Kubernetes node is a Docker container. These containers operate within the same network namespace, facilitating communication via the Docker bridge network. KinD establishes a unique bridge network for each cluster for communication between Kubernetes nodes. Let&rsquo;s explore docker networks.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>macbook-pro % docker network list
</span></span><span style=display:flex><span>NETWORK ID     NAME      DRIVER    SCOPE
</span></span><span style=display:flex><span>8fd3d395c77e   bridge    bridge    local
</span></span><span style=display:flex><span>457bca38a85e   host      host      local
</span></span><span style=display:flex><span>53ced5328608   kind      bridge    local
</span></span><span style=display:flex><span>c96ad8e9a9bb   none      null      local
</span></span></code></pre></div><p>When examining the network setup, you&rsquo;ll likely identify two bridge networks: <code>bridge</code> and <code>kind</code>. <code>bridge</code> is a system-wide bridge network managed by Docker, used for all Docker containers on the host machine. In contrast, <code>kind</code> is specific to each Kind cluster and used exclusively by Kubernetes nodes within that cluster.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>macbook-pro % docker inspect kind
</span></span><span style=display:flex><span>[
</span></span><span style=display:flex><span>   {
</span></span><span style=display:flex><span>       &#34;Name&#34;: &#34;kind&#34;,
</span></span><span style=display:flex><span>       &#34;Id&#34;: &#34;53ced532860890f57acb0f315561d6af24550e0f052f886f3361bcc0ca94733f&#34;,
</span></span><span style=display:flex><span>       &#34;Created&#34;: &#34;2024-03-12T16:24:53.318676142Z&#34;,
</span></span><span style=display:flex><span>       &#34;Scope&#34;: &#34;local&#34;,
</span></span><span style=display:flex><span>       &#34;Driver&#34;: &#34;bridge&#34;,
</span></span><span style=display:flex><span>       &#34;EnableIPv6&#34;: true,
</span></span><span style=display:flex><span>       &#34;IPAM&#34;: {
</span></span><span style=display:flex><span>           &#34;Driver&#34;: &#34;default&#34;,
</span></span><span style=display:flex><span>           &#34;Options&#34;: {},
</span></span><span style=display:flex><span>           &#34;Config&#34;: [
</span></span><span style=display:flex><span>               {
</span></span><span style=display:flex><span>                   &#34;Subnet&#34;: &#34;172.18.0.0/16&#34;,
</span></span><span style=display:flex><span>                   &#34;Gateway&#34;: &#34;172.18.0.1&#34;
</span></span><span style=display:flex><span>               },
</span></span><span style=display:flex><span>               {
</span></span><span style=display:flex><span>                   &#34;Subnet&#34;: &#34;fc00:f853:ccd:e793::/64&#34;,
</span></span><span style=display:flex><span>                   &#34;Gateway&#34;: &#34;fc00:f853:ccd:e793::1&#34;
</span></span><span style=display:flex><span>               }
</span></span><span style=display:flex><span>           ]
</span></span><span style=display:flex><span>       },
</span></span><span style=display:flex><span>       &#34;Internal&#34;: false,
</span></span><span style=display:flex><span>       &#34;Attachable&#34;: false,
</span></span><span style=display:flex><span>       &#34;Ingress&#34;: false,
</span></span><span style=display:flex><span>       &#34;ConfigFrom&#34;: {
</span></span><span style=display:flex><span>           &#34;Network&#34;: &#34;&#34;
</span></span><span style=display:flex><span>       },
</span></span><span style=display:flex><span>       &#34;ConfigOnly&#34;: false,
</span></span><span style=display:flex><span>       &#34;Containers&#34;: {
</span></span><span style=display:flex><span>           &#34;006079fd44c64434e818da824356ad71fd80ad05935f88777d1d2d906554ddf5&#34;: {
</span></span><span style=display:flex><span>               &#34;Name&#34;: &#34;kind-control-plane&#34;,
</span></span><span style=display:flex><span>               &#34;EndpointID&#34;: &#34;2da48bb2bbeaefdd98e4749777d7401c84d015e076a4b555dc1686ee1014d63d&#34;,
</span></span><span style=display:flex><span>               &#34;MacAddress&#34;: &#34;02:42:ac:12:00:03&#34;,
</span></span><span style=display:flex><span>               &#34;IPv4Address&#34;: &#34;172.18.0.3/16&#34;,
</span></span><span style=display:flex><span>               &#34;IPv6Address&#34;: &#34;fc00:f853:ccd:e793::3/64&#34;
</span></span><span style=display:flex><span>           },
</span></span><span style=display:flex><span>           &#34;6731d2e4298603aa240dab421be84ae0beb1e5c81f27ea59c4097c4844462a82&#34;: {
</span></span><span style=display:flex><span>               &#34;Name&#34;: &#34;kind-worker&#34;,
</span></span><span style=display:flex><span>               &#34;EndpointID&#34;: &#34;d3f13cdea8f66fe3c29c2ff159828d977ef88cf7f2974944c11a3b16e18923d9&#34;,
</span></span><span style=display:flex><span>               &#34;MacAddress&#34;: &#34;02:42:ac:12:00:02&#34;,
</span></span><span style=display:flex><span>               &#34;IPv4Address&#34;: &#34;172.18.0.2/16&#34;,
</span></span><span style=display:flex><span>               &#34;IPv6Address&#34;: &#34;fc00:f853:ccd:e793::2/64&#34;
</span></span><span style=display:flex><span>           }
</span></span><span style=display:flex><span>       },
</span></span><span style=display:flex><span>       &#34;Options&#34;: {
</span></span><span style=display:flex><span>           &#34;com.docker.network.bridge.enable_ip_masquerade&#34;: &#34;true&#34;
</span></span><span style=display:flex><span>       },
</span></span><span style=display:flex><span>       &#34;Labels&#34;: {}
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>A Linux bridge behaves like a network switch. It forwards packets between interfaces that are connected to it. In the container world, The bridge network functions as a virtual networking interface, interconnecting containers (Linux network namespaces) via virtual Ethernet pairs (veth pairs). Each container is configured with its own veth pair, with one end connected to the bridge network. This arrangement enables communication between containers internally and with the host system.</p><p>Linux Namespaces play a pivotal role in containerization by providing isolated environments for individual containers. Each Docker container is encapsulated within its own namespace, ensuring it has its distinct IP address, routing table, and network configuration. This isolation mechanism prevents interference between containers and ensures the host system&rsquo;s integrity. (check our next article for more details about linux network namespace technologie in container&rsquo;s world)</p><p><img src=bridge-network.png alt=alt></p><p>Now, let&rsquo;s attempt to ping one of the node IPs. Remember, in a KinD cluster, nodes are Docker containers.
If you&rsquo;re using a Linux-based OS, the ping will be successful. However, if you&rsquo;re on macOS, you&rsquo;ll observe:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>macbook-pro % ping 172.18.0.2
</span></span><span style=display:flex><span>PING 172.18.0.2 (172.18.0.2): 56 data bytes
</span></span><span style=display:flex><span>Request timeout for icmp_seq 0
</span></span><span style=display:flex><span>Request timeout for icmp_seq 1
</span></span><span style=display:flex><span>Request timeout for icmp_seq 2
</span></span></code></pre></div><p>The ping is timing out!</p><h1 class="relative group font-normal">Container&rsquo;s Networking on MacOS<div id=containers-networking-on-macos class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#containers-networking-on-macos aria-label=Anchor>#</a></span></h1><p>In macOS, Docker-for-Mac doesn&rsquo;t directly expose container networks on the host system. Instead, it operates by running a Linux VM in the background and launches containers within that VM. It enables connections to containers via port binding (L4) and doesn&rsquo;t support connections by IP address (L3).</p><p>Let&rsquo;s explore the routing table in the MacOS host:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>macbook-pro % netstat -rn
</span></span><span style=display:flex><span>Routing tables
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Internet:
</span></span><span style=display:flex><span>Destination        Gateway            Flags           Netif Expire
</span></span><span style=display:flex><span>default            192.168.1.1        UGScg             en0
</span></span><span style=display:flex><span>default            link#17            UCSIg       bridge100      !
</span></span><span style=display:flex><span>10.33.33.2         10.33.33.1         UH              utun0
</span></span><span style=display:flex><span>127                127.0.0.1          UCS               lo0
</span></span><span style=display:flex><span>127.0.0.1          127.0.0.1          UH                lo0
</span></span><span style=display:flex><span>169.254            link#6             UCS               en0      !
</span></span><span style=display:flex><span>192.168.1          link#6             UCS               en0      !
</span></span><span style=display:flex><span>192.168.1.1/32     link#6             UCS               en0      !
</span></span><span style=display:flex><span>192.168.1.1        84:90:a:3e:a2:4    UHLWIir           en0   1126
</span></span><span style=display:flex><span>192.168.1.10/32    link#6             UCS               en0      !
</span></span><span style=display:flex><span>192.168.1.11       80:c:f9:6b:68:84   UHLWI             en0   1100
</span></span><span style=display:flex><span>192.168.64         link#17            UC          bridge100      !
</span></span><span style=display:flex><span>192.168.64.1       16.7d.da.9a.15.64  UHLWI             lo0
</span></span><span style=display:flex><span>192.168.64.3       6.c5.4b.b4.32.aa   UHLWIi      bridge100    248
</span></span><span style=display:flex><span>224.0.0/4          link#6             UmCS              en0      !
</span></span><span style=display:flex><span>224.0.0.251        1:0:5e:0:0:fb      UHmLWI            en0
</span></span><span style=display:flex><span>224.0.0.251        1:0:5e:0:0:fb      UHmLWIg     bridge100
</span></span><span style=display:flex><span>239.255.255.250    1:0:5e:7f:ff:fa    UHmLWI            en0
</span></span><span style=display:flex><span>255.255.255.255/32 link#6             UCS               en0      !
</span></span></code></pre></div><p>As evident, there&rsquo;s no network configuration to access the Docker network within the Docker Desktop VM. By contrast, comparing this with the Linux host&rsquo;s <code>ip route</code> output reveals significant configuration differences.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>root@ubuntu # ip route
</span></span><span style=display:flex><span>default via 192.168.64.1 dev enp0s1 proto dhcp src 192.168.64.3 metric 100
</span></span><span style=display:flex><span>172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown
</span></span><span style=display:flex><span>172.18.0.0/16 dev br-38055463db3c proto kernel scope link src 172.18.0.1
</span></span><span style=display:flex><span>192.168.64.0/24 dev enp0s1 proto kernel scope link src 192.168.64.3 metric 100
</span></span><span style=display:flex><span>192.168.64.1 dev enp0s1 proto dhcp scope link src 192.168.64.3 metric 100
</span></span></code></pre></div><p>Here, we can see a route to the container&rsquo;s subnet via the network interface <code>br-38055463db3c</code>. The <code>172.18.0.0/16 dev br-38055463db3c proto kernel scope link src 172.18.0.1</code> line in the routing table indicates that the IP address range <code>172.18.0.0/16</code> is associated with the network device <code>br-38055463db3c</code>, which is the bridge interface.</p><p>Now let’s list the network interfaces in the Linux host:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>root@ubuntu # ip link 
</span></span><span style=display:flex><span>…
</span></span><span style=display:flex><span>4: br-38055463db3c: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT group default 
</span></span><span style=display:flex><span>    link/ether 02:42:c4:e4:5f:7e brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>6: vethf413b4a@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-38055463db3c state UP mode DEFAULT group default 
</span></span><span style=display:flex><span>    link/ether 0a:86:ac:2a:fe:a5 brd ff:ff:ff:ff:ff:ff link-netnsid 1
</span></span><span style=display:flex><span>8: vethb9242a9@if7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-38055463db3c state UP mode DEFAULT group default 
</span></span><span style=display:flex><span>    link/ether a2:11:09:57:4f:26 brd ff:ff:ff:ff:ff:ff link-netnsid 0
</span></span><span style=display:flex><span>…
</span></span></code></pre></div><p>Let’s break down the configuration:</p><p><strong>br-38055463db3c</strong>: The bridge interface.</p><p><strong>vethf413b4a@if5</strong>: This is a virtual Ethernet interface (veth) named &ldquo;vethf413b4a&rdquo; It is paired with another veth interface in a network namespace (container). It is connected to the bridge interface &ldquo;br-38055463db3c&rdquo;, this represents the link between the container and bridge discussed previously.</p><p><strong>vethb9242a9@if7</strong>: Similar to the second interface, this is another veth interface named &ldquo;vethb9242a9&rdquo;. It is paired with another veth interface in a network namespace (container). Also connected to the same bridge interface &ldquo;br-38055463db3c&rdquo;.</p><p>This means the docker containers are linked to the host via the bridge network. You can observe the traffic going in/out of the containers by running <code>tcpdump -i vethf413b4a</code> and <code>tcpdump -i vethb9242a9</code> from your local host.</p><p>To achieve similar connectivity on macOS host, we are going to use <a href="https://github.com/chipmk/docker-mac-net-connect?tab=readme-ov-file#installation">docker mac net connect</a>. This tool establishes a basic network tunnel between macOS and the Docker Desktop Linux VM. <code>docker-mac-net-connect</code> creates a virtual network interface (<code>utun</code>), acting as the bridge between your Mac and the Docker Desktop Linux VM.</p><p><img src=docker-mac-net-connect.png alt=alt></p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>brew install chipmk/tap/docker-mac-net-connect
</span></span><span style=display:flex><span>sudo brew services start chipmk/tap/docker-mac-net-connect
</span></span></code></pre></div><p>Check the routing table again.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>macbook-pro % netstat -rn
</span></span><span style=display:flex><span>Routing tables
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Internet:
</span></span><span style=display:flex><span>Destination        Gateway            Flags           Netif Expire
</span></span><span style=display:flex><span>default            192.168.1.1        UGScg             en0
</span></span><span style=display:flex><span>default            link#17            UCSIg       bridge100      !
</span></span><span style=display:flex><span>10.33.33.2         10.33.33.1         UH              utun0
</span></span><span style=display:flex><span>127                127.0.0.1          UCS               lo0
</span></span><span style=display:flex><span>127.0.0.1          127.0.0.1          UH                lo0
</span></span><span style=display:flex><span>169.254            link#6             UCS               en0      !
</span></span><span style=display:flex><span>172.17             utun0              USc             utun0
</span></span><span style=display:flex><span>172.18             utun0              USc             utun0
</span></span><span style=display:flex><span>192.168.1          link#6             UCS               en0      !
</span></span><span style=display:flex><span>192.168.1.1/32     link#6             UCS               en0      !
</span></span><span style=display:flex><span>192.168.1.1        84:90:a:3e:a2:4    UHLWIir           en0   1126
</span></span><span style=display:flex><span>192.168.1.10/32    link#6             UCS               en0      !
</span></span><span style=display:flex><span>192.168.1.11       80:c:f9:6b:68:84   UHLWI             en0   1100
</span></span><span style=display:flex><span>192.168.64         link#17            UC          bridge100      !
</span></span><span style=display:flex><span>192.168.64.1       16.7d.da.9a.15.64  UHLWI             lo0
</span></span><span style=display:flex><span>192.168.64.3       6.c5.4b.b4.32.aa   UHLWIi      bridge100    248
</span></span><span style=display:flex><span>224.0.0/4          link#6             UmCS              en0      !
</span></span><span style=display:flex><span>224.0.0.251        1:0:5e:0:0:fb      UHmLWI            en0
</span></span><span style=display:flex><span>224.0.0.251        1:0:5e:0:0:fb      UHmLWIg     bridge100
</span></span><span style=display:flex><span>239.255.255.250    1:0:5e:7f:ff:fa    UHmLWI            en0
</span></span><span style=display:flex><span>255.255.255.255/32 link#6             UCS               en0      !
</span></span></code></pre></div><p>Now, multiple routes have been added to the routing table. <code>172.18 utun0 USc utun0</code> indicates that to access the subnet 172.18/16 (the docker network), the traffic should go through the network interface <code>utun0</code>. This network interface is connected on the other side of the tunnel to the Docker VM.</p><p>The other end of the tunnel (docker VM) is configured by a one-time container with sufficient privileges to configure the Linux host’s network interfaces. The container creates the interface, then exits. Despite the container&rsquo;s termination, the VM interface continues to function because it was created within the Linux host’s network namespace.</p><p>With these configurations in place, the ping command will function once again, indicating that we now have access to the Docker&rsquo;s network from the macOS host.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>macbook-pro % ping 172.18.0.2
</span></span><span style=display:flex><span>PING 172.18.0.2 (172.18.0.2): 56 data bytes
</span></span><span style=display:flex><span>Request timeout for icmp_seq 0
</span></span><span style=display:flex><span>Request timeout for icmp_seq 1
</span></span><span style=display:flex><span>Request timeout for icmp_seq 2
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Request timeout for icmp_seq 20
</span></span><span style=display:flex><span>64 bytes from 172.18.0.2: icmp_seq=21 ttl=63 time=3.334 ms
</span></span><span style=display:flex><span>64 bytes from 172.18.0.2: icmp_seq=22 ttl=63 time=1.118 ms
</span></span><span style=display:flex><span>64 bytes from 172.18.0.2: icmp_seq=23 ttl=63 time=1.016 ms
</span></span></code></pre></div><h1 class="relative group font-normal">Implementing Load Balancer service in KinD cluster with Cilium<div id=implementing-load-balancer-service-in-kind-cluster-with-cilium class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#implementing-load-balancer-service-in-kind-cluster-with-cilium aria-label=Anchor>#</a></span></h1><p>To enable north/south traffic in your home lab, deploying a load balancer is a straightforward option. Cilium provides a load balancer feature that allows for load balancing in bare-metal Kubernetes setups. Announcing the load balancer IP to the network is crucial for proper traffic routing, which can be achieved through BGP or L2 routing.</p><p><em>BGP</em>: BGP stands as a dynamic routing protocol widely utilized in operational Kubernetes environments to broadcast external IP addresses. While its setup may hide greater complexity, BGP brings scalability and resilience through dynamic routing.</p><p><em>L2 Layer</em>: Alternatively, announcing the LB IP at the L2 layer simplifies the configuration process but may compromise the flexibility and scalability offered by BGP. This method suits smaller, less intricate deployments where simplicity takes precedence.</p><p>Within our home lab setup, we&rsquo;ll use Cilium&rsquo;s advanced networking features; LB-IPAM alongside L2 announcements. LB-IPAM handles the assignment of IP addresses to services of type LoadBalancer, while L2 announcements ensure services become visible and accessible across the local area network (L2 network).</p><p>Now let&rsquo;s deploy a simple Kubernetes service of type load balancer:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>apiVersion</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>v1</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>kind</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Service</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>sampleservice</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>spec</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>type</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>LoadBalancer</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>ports</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>- <span style=color:#7ee787>port</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>80</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>selector</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>app</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>myapp</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>---</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>apiVersion</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>apps/v1</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>kind</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Deployment</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>sampleapp</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>spec</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>selector</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>matchLabels</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>app</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>myapp</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>replicas</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>1</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>template</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>labels</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>app</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>myapp</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>spec</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>containers</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>myserver</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>image</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>nginx</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>imagePullPolicy</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>IfNotPresent</span><span style=color:#6e7681>
</span></span></span></code></pre></div><p>Check the status of the service:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>macbook-pro % kubectl get svc
</span></span><span style=display:flex><span>NAME            TYPE           CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE
</span></span><span style=display:flex><span>kubernetes      ClusterIP      10.96.0.1     &lt;none&gt;        443/TCP        5h30m
</span></span><span style=display:flex><span>sampleservice   LoadBalancer   10.96.28.96   &lt;pending&gt;     80:31508/TCP   4h53m
</span></span></code></pre></div><p>As evident, the service is created with a pending external IP. To initiate IP assignment for the service load balancer, we need to deploy an lb-ipam pool. This pool defines the IP range from which cilium can select an IP address for the service.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>apiVersion</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;cilium.io/v2alpha1&#34;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>kind</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>CiliumLoadBalancerIPPool</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;lb-pool-1&#34;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>spec</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>cidrs</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span>- <span style=color:#7ee787>cidr</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;172.18.250.0/24&#34;</span><span style=color:#6e7681>
</span></span></span></code></pre></div><p>Now let&rsquo;s check the service again:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>macbook-pro % kubectl get svc
</span></span><span style=display:flex><span>NAME            TYPE           CLUSTER-IP    EXTERNAL-IP    PORT(S)        AGE
</span></span><span style=display:flex><span>kubernetes      ClusterIP      10.96.0.1     &lt;none&gt;         443/TCP        5h32m
</span></span><span style=display:flex><span>sampleservice   LoadBalancer   10.96.28.96   172.18.250.1   80:31508/TCP   4h56m
</span></span></code></pre></div><p>The external IP has now been allocated to the service from the LB-IPAM pool. To implement advanced filtering on the pool, such as service selectors, please consult the documentation <a href=https://docs.cilium.io/en/stable/network/lb-ipam/#service-selectors>here</a>.</p><p>Once the IP has been assigned, we should be able to broadcast it locally (to all other devices sharing the same physical network L2). To achieve this, we need to create a cilium announcement policy.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>apiVersion</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;cilium.io/v2alpha1&#34;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>kind</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>CiliumL2AnnouncementPolicy</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>announcement-policy-1</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>spec</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>externalIPs</span>:<span style=color:#6e7681> </span><span style=color:#79c0ff>false</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>loadBalancerIPs</span>:<span style=color:#6e7681> </span><span style=color:#79c0ff>true</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>interfaces</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>- <span style=color:#a5d6ff>^eth[0-9]+</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>nodeSelector</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>matchExpressions</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>- <span style=color:#7ee787>key</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>node-role.kubernetes.io/control-plane</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>operator</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>DoesNotExist</span><span style=color:#6e7681>
</span></span></span></code></pre></div><p>The &ldquo;interfaces&rdquo; field specifies the network interfaces over which the chosen services will be broadcast. This field is optional, if left unspecified, all interfaces will be utilized. It&rsquo;s essential to note that L2 announcements will function only if the selected devices are included in the &lsquo;devices&rsquo; set specified in the field &lsquo;devices="{eth0,net0}"&rsquo;.</p><p>L2 announcement functions are based on the Address Resolution Protocol (ARP). ARP is a fundamental protocol in computer networks used to map IP addresses to MAC addresses. Here&rsquo;s a breakdown of ARP&rsquo;s operation when trying to access Kubernetes load balancer service “curl 172.18.250.1/” from the local computer:</p><ol><li><p>ARP Process Begins: The local computer checks its ARP cache to see if it has the MAC address of the destination IP address (docker container). If not found, an ARP request process begins.</p></li><li><p>ARP Request Packet Creation: The local computer constructs an ARP request packet containing the IP address of the destination (the LoadBalancer IP) and its own MAC address. The destination MAC address in the ARP request packet is set to the broadcast MAC address (FF:FF:FF:FF:FF:FF) to ensure all devices on the local network receive it.</p></li><li><p>ARP Request Broadcast: The local computer sends the ARP request packet as a broadcast frame onto the local network segment (L2 network). All devices on the local network receive this ARP request.</p></li><li><p>Cilium Agent Responds: after receiving the ARP request by the Kubernetes nodes, the Cilium agent checks if it has the specified IP address. If found, it responds with an ARP reply packet containing the MAC address of the node (in this case, the Docker container&rsquo;s IP).</p></li><li><p>ARP Reply Packet: The ARP reply packet is sent directly to the MAC address of the local computer that initiated the ARP request.</p></li><li><p>ARP Cache Update: The local computer receives the ARP reply packet, extracts the MAC address of the LoadBalancer, and updates its ARP cache with this mapping. This mapping is cached for future use to avoid sending ARP requests for the same IP address.</p></li></ol><p>The ARP table contains only the most recent MAC address associated with an IP. As a result, only one node in the cluster can reply to requests for a specific IP address. To ensure this, each Cilium agent selects services for its node and participates in leader election using <a href=https://kubernetes.io/docs/concepts/architecture/leases/>Kubernetes leases</a>. Every service corresponds to a lease, and the lease holder is responsible for responding to requests on designated interfaces.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>kubectl get leases -n kube-system
</span></span><span style=display:flex><span>NAME                                       HOLDER                       AGE
</span></span><span style=display:flex><span>…
</span></span><span style=display:flex><span>cilium-l2announce-default-sampleservice     kind-worker                 4m2s
</span></span><span style=display:flex><span>…
</span></span></code></pre></div><p>Now notice that the lease cilium-l2announce-default-sampleservice has elected kind-worker as a leader, in this case the cilium agent in this node will help in the ARP resolution process. Let&rsquo;s capture the ARP traffic arriving at the kind-worker node using tcpdump.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#79c0ff>CILIUM_POD</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#ff7b72>$(</span>kubectl -n kube-system get pod -l k8s-app<span style=color:#ff7b72;font-weight:700>=</span>cilium --field-selector spec.nodeName<span style=color:#ff7b72;font-weight:700>=</span>kind-worker  -o name<span style=color:#ff7b72>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl -n kube-system exec -ti <span style=color:#79c0ff>$CILIUM_POD</span> -- bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>apt-get update <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span> <span style=color:#79c0ff>DEBIAN_FRONTEND</span><span style=color:#ff7b72;font-weight:700>=</span>noninteractive apt-get -y install tcpdump termshark
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tcpdump -i any arp -w arp.pcap
</span></span></code></pre></div><p>Now, open another terminal and run curl command with the Load Balancer IP address.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>curl 172.18.250.1/
</span></span></code></pre></div><p>You&rsquo;ll notice that the curl request is successful.
Go back now to the Cilium agent terminal and stop the running command. Next, open Termshark and load the ARP file to examine the results.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#79c0ff>TERM</span><span style=color:#ff7b72;font-weight:700>=</span>xterm-256color termshark -r arp.pcap
</span></span></code></pre></div><p><img src=arp-request.png alt=alt></p><p><img src=arp-reply.png alt=alt></p><p>In both screenshots we can see the ARP request and reply details provide insights into how network devices communicate and resolve MAC addresses to IP addresses. Here&rsquo;s an explanation of each component:</p><p>ARP Request (1st screenshot):
Sender&rsquo;s IP Address: The IP address of the device sending the ARP request.
Sender&rsquo;s MAC Address: The MAC address of the device sending the ARP request.
Target IP Address: The IP address for which the MAC address is being requested.
Target MAC Address: This field is typically set to all zeros in ARP requests since the sender is asking for the MAC address associated with a specific IP address. It&rsquo;s often referred to as the &ldquo;broadcast MAC address&rdquo; (FF:FF:FF:FF:FF:FF).</p><p>ARP Reply (2nd screenshot):
Sender&rsquo;s IP Address: The IP address of the device sending the ARP reply.
Sender&rsquo;s MAC Address: The MAC address of the device sending the ARP reply.
Target IP Address: The IP address for which the MAC address is being provided.
Target MAC Address: The MAC address associated with the target IP address, as requested in the ARP request.</p><h1 class="relative group font-normal">Conclusion<div id=conclusion class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#conclusion aria-label=Anchor>#</a></span></h1><p>Setting up the networking and load balancing in a KinD cluster with Cilium involves careful configuration and troubleshooting. By understanding the underlying principles and employing the right tools and techniques, you can ensure smooth operation and optimal performance of your home lab environment.</p><p>Check our labs here <a href="https://github.com/fence-io/playground?tab=readme-ov-file#available-labs">https://github.com/fence-io/playground?tab=readme-ov-file#available-labs</a></p></div><div class="hidden md:block mx-8"><div class="flex flex-col sticky top-[8.4rem]"><div class="toc print:hidden"><details open class="toc-right mt-0 overflow-hidden"><summary class="block py-1 text-lg font-semibold cursor-pointer text-neutral-100">Table of Contents</summary><div class="py-1 border-dotted border-l pl-5 border-neutral-600"><nav id=TableOfContents><ul><li><a href=#requirements>Requirements</a></li><li><a href=#setting-up-kubernetes-in-docker>Setting Up Kubernetes in Docker</a></li><li><a href=#ciliums-networking-options>Cilium&rsquo;s Networking options</a></li><li><a href=#network-configuration-of-kind-cluster>Network Configuration of KinD Cluster</a></li><li><a href=#containers-networking-on-macos>Container&rsquo;s Networking on MacOS</a></li><li><a href=#implementing-load-balancer-service-in-kind-cluster-with-cilium>Implementing Load Balancer service in KinD cluster with Cilium</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details><script>(function(){var t,e=$("#TableOfContents");if(console.log(e),e.length>0){t=$(window);function n(){var n,i=t.scrollTop(),o=$(".anchor"),s="";if(console.log(o),o.each(function(e,t){t=$(t),t.offset().top-$(window).height()/3<=i&&(s=t.attr("id"))}),n=e.find("a.active"),n.length==1&&n.eq(0).attr("href")=="#"+s)return!0;n.each(function(e,t){$(t).removeClass("active")}),e.find('a[href="#'+s+'"]').addClass("active")}t.on("scroll",n)}})()</script></div><a href=https://codespaces.new/fence-io/playground target=_blank class=mt-5><img src=https://github.com/codespaces/badge.svg alt='Open in GitHub Codespaces' style=max-width:100%></a></div><div class="absolute top-[110vh] bottom-[4rem] w-12 mx-auto overflow-y-clip"><div class="sticky top-[calc(100vh-5rem)] pb-1 flex items-center justify-center space-x-7"><a href=#top class="p-2 w-12 h-12 ring-1 ring-slate-900/5 dark:ring-slate-200/20 shadow-lg rounded-full text-base hover:text-primary-600 dark:hover:text-primary-400"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18"/></svg></a></div></div></div></div></div></main><div class="bg-neutral/70 text-neutral-900 dark:bg-neutral-900/70 dark:text-neutral"><div class="mx-6 my-2"><nav class="flex md:hidden items-center justify-between space-x-2 mb-2"><a href=https://github.com/fence-io/website class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://todo class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://todo class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1s21.16-47.06 47.06-47.06h47.06v47.06zm23.72.0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9.0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9.0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96.0 222.8.0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06S448 171 448 196.9s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72.0c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9.0 47.06 21.16 47.06 47.06S309 480 283.1 480s-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9.0-47.06-21.16-47.06-47.06s21.16-47.06 47.06-47.06h117.84c25.9.0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H283.1z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://www.linkedin.com/groups/13033088/ class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://todo class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78.0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://groups.google.com/g/fence-community class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 488 512"><path fill="currentcolor" d="M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2.0 256S110.8 8 248 8c66.8.0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2.0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"/></svg></span></span><p class="text-base font-medium" title></p></a></nav><div class="text-neutral-900 dark:text-neutral flex mx-auto items-center justify-between"><div class=text><p class="text-base font-medium">Made with ❤️ by and for policy lovers</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by
<a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a>
&
Inspired by
<a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><nav class="hidden md:flex items-center space-x-5"><a href=https://github.com/fence-io/website class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://todo class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://todo class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1s21.16-47.06 47.06-47.06h47.06v47.06zm23.72.0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9.0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9.0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96.0 222.8.0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06S448 171 448 196.9s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72.0c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9.0 47.06 21.16 47.06 47.06S309 480 283.1 480s-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9.0-47.06-21.16-47.06-47.06s21.16-47.06 47.06-47.06h117.84c25.9.0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H283.1z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://www.linkedin.com/groups/13033088/ class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://todo class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78.0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://groups.google.com/g/fence-community class="flex items-center" target=_blank><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 488 512"><path fill="currentcolor" d="M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2.0 256S110.8 8 248 8c66.8.0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2.0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"/></svg></span></span><p class="text-base font-medium" title></p></a></nav></div><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://fence-io.github.io/website/.pr/89/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></div></body></html>